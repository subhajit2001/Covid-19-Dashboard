<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>India Statewise Distribution</title>
  <script src="d3-min.js"></script>
  <script src="topojson-min.js"></script>
  <script src="https://rawgit.com/Anujarya300/bubble_maps/master/data/geography-data/datamaps.none.js"></script>
  <link href="style.css" rel="stylesheet" />
</head>
<body style="background-color: #160c42;">
    <center><div id="india" style="height: 600px; width: 900px;margin:0"></div></center>
    <script>
    alert("Hover over the map the view details\nIf the map is not rendered properly, Refresh it again.\nClick OK to continue... ")
    var result = [];
    result.push(['StateCode', 'State','Confirmed']);

    var request = new XMLHttpRequest()
    request.open('GET', 'https://api.covid19india.org/data.json', true)
    request.onload = function() {
      // Begin accessing JSON data here
      var data1 = JSON.parse(this.response)
      if (request.status >= 200 && request.status < 400) {

        data1.statewise.slice(1,38).forEach(movie => {
          if(movie['state']==="Odisha")
          {
            movie['statecode']="OD";
          }
          if(movie['state']==="Telangana")
          {
            movie['statecode']="TS";
          }
         result.push([movie['statecode'],movie['state'],movie['confirmed']]);
       })
        var bubble_map = new Datamap({
            element: document.getElementById('india'),
            scope: 'india',
            geographyConfig: {
                popupOnHover: true,
                highlightOnHover: true,
                borderColor: '#444',
                borderWidth: 0.5,
                dataUrl: 'https://rawgit.com/Anujarya300/bubble_maps/master/data/geography-data/india.topo.json'
                //dataJson: topoJsonData
            },
            fills: {
                'MAJOR': '#ff637b',
                'MEDIUM': '#0fa0fa',
                'MINOR': '#bada55',
                defaultFill: '#40f76b'
            },
            data: {

            },
            setProjection: function (element) {
                var projection = d3.geo.mercator()
                    .center([78.9629, 23.5937]) // always in [East Latitude, North Longitude]
                    .scale(1000);
                var path = d3.geo.path().projection(projection);
                return { path: path, projection: projection };
            }
        });
        console.log(result);
        let bubbles = [
            {
                centered: result[1][0],
                fillKey: "MAJOR",
                radius: (result[1][2]/50),
                state: result[1][1]
            },
            {
                centered: result[2][0],
                fillKey: "MAJOR",
                radius: (result[2][2]/50),
                state: result[2][1]
            },
            {
                centered: result[3][0],
                fillKey: "MAJOR",
                radius: (result[3][2]/50),
                state: result[3][1]
            },
            {
                centered: result[4][0],
                fillKey: "MAJOR",
                radius: (result[4][2]/50),
                state: result[4][1]
            },
            {
                centered: result[5][0],
                fillKey: "MAJOR",
                radius: (result[5][2]/50),
                state: result[5][1]
            },
            {
                centered: result[6][0],
                fillKey: "MAJOR",
                radius: (result[6][2]/50),
                state: result[6][1]
            },
            {
                centered: result[7][0],
                fillKey: "MAJOR",
                radius: (result[7][2]/50),
                state: result[7][1]
            },
            {
                centered: result[8][0],
                fillKey: "MAJOR",
                radius: (result[8][2]/50),
                state: result[8][1]
            },
            {
                centered: result[9][0],
                fillKey: "MAJOR",
                radius: (result[9][2]/50),
                state: result[9][1]
            },
            {
                centered: result[10][0],
                fillKey: "MAJOR",
                radius: (result[10][2]/50),
                state: result[10][1]
            },
            {
                centered: result[11][0],
                fillKey: "MAJOR",
                radius: (result[11][2]/50),
                state: result[11][1]
            },
            {
                centered: result[12][0],
                fillKey: "MAJOR",
                radius: (result[12][2]/50),
                state: result[12][1]
            },
            {
                centered: result[13][0],
                fillKey: "MAJOR",
                radius: (result[13][2]/50),
                state: result[13][1]
            },
            {
                centered: result[14][0],
                fillKey: "MAJOR",
                radius: (result[14][2]/50),
                state: result[14][1]
            },
            {
                centered: result[15][0],
                fillKey: "MAJOR",
                radius: (result[15][2]/50),
                state: result[15][1]
            },
            {
                centered: result[16][0],
                fillKey: "MAJOR",
                radius: (result[16][2]/50),
                state: result[16][1]
            },
            {
                centered: result[17][0],
                fillKey: "MAJOR",
                radius: (result[17][2]/50),
                state: result[17][1]
            },
            {
                centered: result[18][0],
                fillKey: "MAJOR",
                radius: (result[18][2]/50),
                state: result[18][1]
            },
            {
                centered: result[19][0],
                fillKey: "MAJOR",
                radius: (result[19][2]/50),
                state: result[19][1]
            },
            {
                centered: result[20][0],
                fillKey: "MAJOR",
                radius: (result[20][2]/50),
                state: result[20][1]
            },
            {
                centered: result[21][0],
                fillKey: "MAJOR",
                radius: (result[21][2]/50),
                state: result[21][1]
            },
            {
                centered: result[22][0],
                fillKey: "MAJOR",
                radius: (result[22][2]/50),
                state: result[22][1]
            },
            {
                centered: result[23][0],
                fillKey: "MAJOR",
                radius: (result[23][2]/50),
                state: result[23][1]
            },
            {
                centered: result[24][0],
                fillKey: "MAJOR",
                radius: (result[24][2]/50),
                state: result[24][1]
            },
            {
                centered: result[25][0],
                fillKey: "MAJOR",
                radius: (result[25][2]/50),
                state: result[25][1]
            },
            {
                centered: result[26][0],
                fillKey: "MAJOR",
                radius: (result[26][2]/50),
                state: result[26][1]
            },
            {
                centered: result[27][0],
                fillKey: "MAJOR",
                radius: (result[27][2]/50),
                state: result[27][1]
            },
            {
                centered: result[28][0],
                fillKey: "MAJOR",
                radius: (result[28][2]/50),
                state: result[28][1]
            },
            {
                centered: result[29][0],
                fillKey: "MAJOR",
                radius: (result[29][2]/50),
                state: result[29][1]
            },
            {
                centered: result[30][0],
                fillKey: "MAJOR",
                radius: (result[30][2]/50),
                state: result[30][1]
            },
            {
                centered: result[31][0],
                fillKey: "MAJOR",
                radius: (result[31][2]/50),
                state: result[31][1]
            },
            {
                centered: result[32][0],
                fillKey: "MAJOR",
                radius: (result[32][2]/50),
                state: result[32][1]
            },
            {
                centered: result[33][0],
                fillKey: "MAJOR",
                radius: (result[33][2]/50),
                state: result[33][1]
            },
            {
                centered: result[34][0],
                fillKey: "MAJOR",
                radius: (result[34][2]/50),
                state: result[34][1]
            },
            {
                centered: result[35][0],
                fillKey: "MAJOR",
                radius: (result[35][2]/50),
                state: result[35][1]
            },
            {
                centered: result[36][0],
                fillKey: "MAJOR",
                radius: (result[36][2]/50),
                state: result[36][1]
            },
            {
                centered: result[37][0],
                fillKey: "MAJOR",
                radius: (result[37][2]/50),
                state: result[37][1]
            },

  ]
        // // ISO ID code for city or <state></state>
        setTimeout(() => { // only start drawing bubbles on the map when map has rendered completely.
            bubble_map.bubbles(bubbles, {
                popupTemplate: function (geo, data) {
                    return `<div class="hoverinfo">State Name: ${data.state}, Confirmed Positive Cases: ${Math.round(data.radius*50)}</div>`;
                }
            });
        }, 1000);
      }
  }
  request.send();
  </script>
</body>

</html>
